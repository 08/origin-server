- breadcrumb_for_application @application, 'Scale your Application'
- content_for :page_title, 'Scale your Application'

%h1 Scale your Application

%section
  - @gear_groups.each do |gear_group|
    .gear-group.tile
      %h2
        = gear_group.cartridges.first.display_name
        - if gear_group.cartridges.length > 1
          (includes #{gear_group.cartridges[1..-1].map(&:display_name).join(', ')})

      - if gear_group.scales? 
        %p Currently scaled x#{gear_group.gears.length}

        = semantic_form_for gear_group, :simple => true, :url => application_scaling_path do |f|
          = f.inputs :inline => true do
            Scale this cartridge from
            = f.input :scales_from, :as => :select, :collection => 1..16, :input_html => {:style => 'width: auto'}
            to
            = f.input :scales_to, :as => :select, :collection => 1..16, :input_html => {:style => 'width: auto'}
            #{gear_group.gear_profile} gears
            = f.commit_button :label => 'Change', :button_html => {:class => 'btn btn-primary btn-small'}
            = f.loading
            
        - if gear_group.cartridges.any?{ |c| c.tags.include?(:web_framework) }
          %p
            OpenShift is configured to scale this cartridge with 
            #{link_to 'the web proxy HAProxy', scaling_help_url }. OpenShift 
            monitors the incoming web traffic to your application and 
            automatically adds or removes copies of your application 
            (running on their own gears) to serve requests.

          %p
            If you'd like to try out scaling in the absence of heavy traffic to 
            your application, you can execute a command from an application
            SSH session to force your web cartridge to scale up:

          %pre.cli
            :preserve
              ssh #{@application.ssh_string}
              haproxy_ctld -u

          %p
            Each new instance of your web cartridge is created fresh - the normal 
            post, pre, and deploy hooks are executed.  Each cartridge will have its
            own copy of runtime data, so be sure to use a database if you need to share
            data across your web cartridges.
            
          %p
            For more information about scaling your application see
            #{link_to 'our scaling guide in the Developer Center', scaling_help_url}. For
            status information about traffic to your application, see the HAProxy status page:

          %p.well.application-url.larger
            = link_to @application.scale_status_url, @application.scale_status_url, :target => '_blank'

      - elsif gear_group.cartridges.length > 1
        %p These cartridges do not scale.

      - else
        %p This cartridge does not scale.
