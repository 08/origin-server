- breadcrumb_for_application @application, 'Scale your Application'
- content_for :page_title, 'Scale your Application'

%h1 Scale your Application

%section#scaling-gear-groups
  - @gear_groups.each do |gear_group|
    - cartridge = gear_group.cartridges.first
    .gear-group.tile
      %h2
        = cartridge.display_name
        - if gear_group.cartridges.length > 1
          (includes #{gear_group.cartridges[1..-1].map(&:display_name).join(', ')})
        - if gear_group.scales?
          %span.pull-right Scaled x#{gear_group.gears.length}

      - if gear_group.scales? 
        = semantic_form_for cartridge, 
                            :simple => true, 
                            :method => :put,
                            :url => application_scaling_cartridge_path(@application.id, cartridge.name) do |f|
          = f.inputs :inline => true, :important => true do
            Scale this cartridge from
            = f.input :scales_from, :as => :select, :collection => 1..16, :input_html => {:style => 'width: auto'}
            to
            = f.input :scales_to, :as => :select, :collection => 1..16, :input_html => {:style => 'width: auto'}
            #{gear_group.gear_profile} gears
            = f.commit_button :label => 'Save', :button_html => {:class => 'btn btn-small'}
            = f.loading
            
        - if gear_group.cartridges.any?{ |c| c.tags.include?(:web_framework) }

          %hr

          %p
            OpenShift is configured to scale this cartridge with 
            #{link_to 'the web proxy HAProxy', scaling_help_url }. OpenShift 
            monitors the incoming web traffic to your application and 
            automatically adds or removes copies of your cartridge
            (each running on their own gears) to serve requests as need.

          %p
            Each scaled gear is created the same way - the normal 
            post, pre, and deploy hooks are executed.  Each cartridge will have its
            own copy of runtime data, so be sure to use a database if you need to share
            data across your web cartridges.
            
          %p
            For status information about traffic to your application, see the HAProxy status page:

          %p.application-url.larger
            = link_to @application.scale_status_url, @application.scale_status_url, :target => '_blank'

      - elsif gear_group.cartridges.length > 1
        %p These cartridges do not scale.

      - else
        %p This cartridge does not scale.
  %p
    For more information about scaling your application see
    #{link_to 'our scaling guide in the Developer Center', scaling_help_url}.

- content_for :javascripts do
  :javascript
    jQuery('#scaling-gear-groups FORM').each(function() {
      btn = $('INPUT.btn', this)[0];
      $('SELECT', this).change(function() {
        $(btn).addClass('btn-primary');
      });
    });
